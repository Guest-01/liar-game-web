<%- include('layout', { body: `
<div class="container mx-auto px-4 py-8 max-w-lg">
  <a href="/" class="inline-flex items-center gap-2 text-gray-400 hover:text-white mb-8 transition-colors">
    â† ë¡œë¹„ë¡œ ëŒì•„ê°€ê¸°
  </a>

  <div class="bg-gray-800 rounded-2xl p-8 shadow-xl">
    <h1 class="text-3xl font-bold text-center mb-8">ğŸ® ë°© ë§Œë“¤ê¸°</h1>

    <form x-data="createRoomForm()" @submit.prevent="submit()" class="space-y-6">
      <!-- ë‹‰ë„¤ì„ -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">ë‹‰ë„¤ì„</label>
        <input
          type="text"
          x-model="nickname"
          placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”"
          minlength="2"
          maxlength="10"
          required
          class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
        >
      </div>

      <!-- ë°© ì´ë¦„ -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">ë°© ì´ë¦„</label>
        <input
          type="text"
          x-model="roomName"
          placeholder="ë°© ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
          maxlength="20"
          required
          class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
        >
      </div>

      <!-- ê³µê°œ/ë¹„ê³µê°œ -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">ê³µê°œ ì„¤ì •</label>
        <div class="flex gap-4">
          <label class="flex-1 cursor-pointer">
            <input type="radio" x-model="isPublic" :value="true" class="sr-only peer">
            <div class="p-4 bg-gray-700 rounded-lg text-center peer-checked:bg-primary peer-checked:ring-2 peer-checked:ring-primary/50 transition-all">
              ğŸŒ ê³µê°œ
            </div>
          </label>
          <label class="flex-1 cursor-pointer">
            <input type="radio" x-model="isPublic" :value="false" class="sr-only peer">
            <div class="p-4 bg-gray-700 rounded-lg text-center peer-checked:bg-primary peer-checked:ring-2 peer-checked:ring-primary/50 transition-all">
              ğŸ”’ ë¹„ê³µê°œ
            </div>
          </label>
        </div>
      </div>

      <!-- ê²Œì„ ëª¨ë“œ -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">ê²Œì„ ëª¨ë“œ</label>
        <div class="flex gap-4">
          <label class="flex-1 cursor-pointer">
            <input type="radio" x-model="gameMode" value="normal" class="sr-only peer">
            <div class="p-4 bg-gray-700 rounded-lg text-center peer-checked:bg-primary peer-checked:ring-2 peer-checked:ring-primary/50 transition-all">
              <div class="font-semibold">ğŸ¯ ì¼ë°˜</div>
              <div class="text-xs text-gray-400 mt-1">ë¼ì´ì–´ê°€ ìì‹ ì„ ì•</div>
            </div>
          </label>
          <label class="flex-1 cursor-pointer">
            <input type="radio" x-model="gameMode" value="fool" class="sr-only peer">
            <div class="p-4 bg-gray-700 rounded-lg text-center peer-checked:bg-primary peer-checked:ring-2 peer-checked:ring-primary/50 transition-all">
              <div class="font-semibold">ğŸ¤¡ ë°”ë³´</div>
              <div class="text-xs text-gray-400 mt-1">ë¼ì´ì–´ë„ ìì‹ ì„ ëª¨ë¦„</div>
            </div>
          </label>
        </div>
      </div>

      <!-- ìµœëŒ€ ì¸ì› -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          ìµœëŒ€ ì¸ì›: <span x-text="maxPlayers" class="text-primary font-bold"></span>ëª…
        </label>
        <input
          type="range"
          x-model="maxPlayers"
          min="3"
          max="8"
          class="w-full accent-primary"
        >
        <div class="flex justify-between text-xs text-gray-500">
          <span>3ëª…</span>
          <span>8ëª…</span>
        </div>
      </div>

      <!-- ì¹´í…Œê³ ë¦¬ -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">ë‹¨ì–´ ì¹´í…Œê³ ë¦¬</label>
        <select
          x-model="category"
          class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none"
        >
          ${categories.map(c => '<option value="' + c + '">' + c + '</option>').join('')}
        </select>
      </div>

      <!-- ì‹œê°„ ì„¤ì • -->
      <div class="grid grid-cols-3 gap-4">
        <div>
          <label class="block text-xs font-medium text-gray-400 mb-1">ì„¤ëª… ì‹œê°„</label>
          <select x-model="descriptionTime" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm">
            <option value="15">15ì´ˆ</option>
            <option value="30">30ì´ˆ</option>
            <option value="45">45ì´ˆ</option>
            <option value="60">60ì´ˆ</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-400 mb-1">í† ë¡  ì‹œê°„</label>
          <select x-model="discussionTime" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm">
            <option value="60">1ë¶„</option>
            <option value="120">2ë¶„</option>
            <option value="180">3ë¶„</option>
            <option value="240">4ë¶„</option>
            <option value="300">5ë¶„</option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-400 mb-1">ë³€ë¡  ì‹œê°„</label>
          <select x-model="defenseTime" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-sm">
            <option value="15">15ì´ˆ</option>
            <option value="30">30ì´ˆ</option>
            <option value="45">45ì´ˆ</option>
            <option value="60">60ì´ˆ</option>
          </select>
        </div>
      </div>

      <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
      <div x-show="error" x-text="error" class="text-red-400 text-sm text-center"></div>

      <!-- ì œì¶œ ë²„íŠ¼ -->
      <button
        type="submit"
        :disabled="loading"
        class="w-full py-4 bg-gradient-to-r from-primary to-secondary rounded-lg font-bold text-lg hover:opacity-90 transition-opacity disabled:opacity-50"
      >
        <span x-show="!loading">ë°© ë§Œë“¤ê¸°</span>
        <span x-show="loading">ìƒì„± ì¤‘...</span>
      </button>
    </form>
  </div>
</div>

<script>
function createRoomForm() {
  return {
    nickname: localStorage.getItem('nickname') || generateRandomNickname(),
    roomName: '',
    isPublic: true,
    gameMode: 'normal',
    maxPlayers: 6,
    category: '${categories[0]}',
    descriptionTime: 30,
    discussionTime: 180,
    defenseTime: 30,
    loading: false,
    error: '',

    submit() {
      if (this.nickname.length < 2 || this.nickname.length > 10) {
        this.error = 'ë‹‰ë„¤ì„ì€ 2-10ì ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.';
        return;
      }
      if (!this.roomName) {
        this.error = 'ë°© ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.';
        return;
      }

      this.loading = true;
      this.error = '';

      // ë‹‰ë„¤ì„ ì €ì¥
      localStorage.setItem('nickname', this.nickname);

      // Socket.IO ì—°ê²° ë° ë°© ìƒì„±
      const socket = io();

      socket.on('connect', () => {
        socket.emit('create-room', {
          nickname: this.nickname,
          roomName: this.roomName,
          isPublic: this.isPublic,
          maxPlayers: parseInt(this.maxPlayers),
          gameMode: this.gameMode,
          descriptionTime: parseInt(this.descriptionTime),
          discussionTime: parseInt(this.discussionTime),
          defenseTime: parseInt(this.defenseTime),
          category: this.category
        });
      });

      socket.on('room-created', (data) => {
        // ì„¸ì…˜ì— ì†Œì¼“ ID ì €ì¥ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸
        sessionStorage.setItem('socketId', socket.id);
        window.location.href = '/room/' + data.roomCode;
      });

      socket.on('error', (data) => {
        this.error = data.message;
        this.loading = false;
      });
    }
  }
}
</script>
` }) %>
